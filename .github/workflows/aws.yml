name: Flush to Amazon ECS

on:
  workflow_dispatch:

# env:
#   AWS_REGION: MY_AWS_REGION                   # set this to your preferred AWS region, e.g. us-west-1
#   ECR_REPOSITORY: MY_ECR_REPOSITORY           # set this to your Amazon ECR repository name
#   ECS_SERVICE: MY_ECS_SERVICE                 # set this to your Amazon ECS service name
#   ECS_CLUSTER: MY_ECS_CLUSTER                 # set this to your Amazon ECS cluster name
#   ECS_TASK_DEFINITION: MY_ECS_TASK_DEFINITION # set this to the path to your Amazon ECS task definition
#                                                # file, e.g. .aws/task-definition.json
#   CONTAINER_NAME: MY_CONTAINER_NAME           # set this to the name of the container in the
                                               # containerDefinitions section of your task definition
  
# permissions:
#   contents: read

jobs:
  build-info:
    name: Flush
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Flush aws
      uses: chrislennon/action-aws-cli@v1.1
      env:
        ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        PERSONAL_SITE_CF_ID: ${{ secrets.PERSONAL_SITE_CF_ID }}
    - name: Invalidate Cloudfront CDN
      run: aws cloudfront create-invalidation --distribution-id=$env.distribution_id --paths '/*'
      env:
          CLOUDFRONT_DISTRIBUTION_ID: E28UBPK9Z0N99E
      # working-directory: ./modules/fe-personal-site
        
#       with:
#         aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
#         aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#         #aws-region: ${{ env.AWS_REGION }}
#         commands: 'aws cloudfront create-invalidation --distribution-id=${env.distribution_id} --paths /*'
        
